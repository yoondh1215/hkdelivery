<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>


<!-- 로그인 되었을 때와 로그인 안됐을 때를 session.auth, <div> 로 구분. -->
<!-- 로그인 상태시 -->
<div th:if="${session.auth != null}">
로그인 성공!
	<!-- 회원과 점포의 메뉴를 th:block과 th:if 조건으로 나눈다. 세션 auth의 grade를 이용한다. -->
	<th:block th:if="${session.auth.grade == 'mem'}">
	<ul>
		<li><a href="member/memberUpdate">내 정보 수정</a></li>
		<li>쇼핑 보러가기</li> -> 구현할 것
		장바구니
		위시리스트
	</ul>
	
	</th:block>

	<th:block th:if="${session.auth.grade == 'shop'}">
	<ul>
		<li><a href="contract/contractCreate">가맹계약 신청</a></li>
		<li><a href="contract/contractRead">가맹계약서 확인</a></li>
		<li><a href="goods/goodsRegist">상품 등록</a></li>
		<li><a href="goods/goodsList">판매중인 상품 확인 및 수정</a></li>
	</ul>
	
	</th:block>

	

<!-- 링크를 login/logout으로 준 이유는 login 컨트롤러 재활용을 위해서... -->
<a href="login/logout">로그아웃</a>


</div>

<!-- 비로그인 상태시 -->
<div th:if="${session.auth == null}">

<!-- 오류가 있는 경우 LoginCommand가 가진 값을 받아오기 위해 th:object 사용한다 (사용자가 또 치지 말라고. 사용자경험에 중요)-->
<!-- 단, th:object 사용시 처음 시작할 땐 LoginCommand가 없으므로 파싱 에러가 발생. 그러므로 loginCommand를 메인 컨트롤러에 추가해주기 -->
<!-- 오류가 있는 경우 bindingResult result에 정의된 메시지를 span th:if를 줘서 가져온다. -->

<form action="/login/login" method="post" th:object="${loginCommand}">
	<table border="1">
		<tr>
			<td><input type="text" name="id" placeholder="아이디" th:value="${loginCommand.id}"/>
				<span th:if="${#fields.hasErrors('id')}" th:errors="*{id}"></span></td>
			<td rowspan="2"><input type="submit" value="로그인"/></td>
		</tr>
		<tr>
			<td><input type="password" name="password" placeholder="비밀번호" th:value="${loginCommand.password}"/>
			<span th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></span></td>
		</tr>
		<tr>
			<td colspan="2"><a href="member/memberRegist"/>회원 가입</a> || <a href="shop/shopRegist"/>점포 등록</a>
			</td>
		</tr>
	</table>
</form>
</div>


<!-- MainGoodsListService에서 model 로 받아온 상품목록 출력 -->
<table align="center" width="600">
	<tr>	<!-- 상품정보를 옆으로 출력해야 하므로 <td>를 반복 -->
	<!-- goodsList로 받아온 값을 하나씩 dto에 전달, index인 idx는 반복할때마다 0부터 1씩 증가. -->
	<th:block th:each="dto, idx : ${goodsList}">
		<td>
			<a th:href="@{goods/goodsInfo(goodsNum=${dto.goodsNum})}"> <img th:src="|/static/upload/${dto.goodsMain}|"> </a> <br/>
			상품명 : [[${dto.goodsName}]] <br/>
			가격 : [[${dto.goodsPrice}]] <br/>
			배송비 : 
			<!-- 배송비가 0이면 무료배송으로 출력 -->
			<span th:if="${dto.deliveryCost == 0}">무료배송</span>
			<span th:if="${dto.deliveryCost != 0}">[[${dto.deliveryCost}]]</span>
			
		</td>
		<!-- 이러면 옆으로만 계속 출력되기에 3개마다 행을 변경해준다. -->
		<th:block th:if="${idx.count % 3 == 0}" th:utext="'</tr><tr>'">
		</th:block>
	</th:block>	
	</tr>
</table>


</body>
</html>